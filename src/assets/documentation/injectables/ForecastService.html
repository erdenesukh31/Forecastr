<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Forecastr documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Forecastr documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>ForecastService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/forecasts/forecast.service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>forecast service</p>

            </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#forecasts">forecasts</a>
                            </li>
                            <li>
                                <a href="#forecasts$">forecasts$</a>
                            </li>
                            <li>
                                <a href="#months">months</a>
                            </li>
                            <li>
                                <a href="#projects">projects</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#addForecasts">addForecasts</a>
                            </li>
                            <li>
                                <a href="#addMandatoryProjects">addMandatoryProjects</a>
                            </li>
                            <li>
                                <a href="#addProject">addProject</a>
                            </li>
                            <li>
                                <a href="#calculateValues">calculateValues</a>
                            </li>
                            <li>
                                <a href="#getMonthlyForecasts">getMonthlyForecasts</a>
                            </li>
                            <li>
                                <a href="#loadForecast">loadForecast</a>
                            </li>
                            <li>
                                <a href="#loadForecastHistory">loadForecastHistory</a>
                            </li>
                            <li>
                                <a href="#removeProject">removeProject</a>
                            </li>
                            <li>
                                <a href="#reset">reset</a>
                            </li>
                            <li>
                                <a href="#saveForecast">saveForecast</a>
                            </li>
                            <li>
                                <a href="#setForecast">setForecast</a>
                            </li>
                            <li>
                                <a href="#setForecastComment">setForecastComment</a>
                            </li>
                            <li>
                                <a href="#setForecastHistory">setForecastHistory</a>
                            </li>
                            <li>
                                <a href="#unlockForecast">unlockForecast</a>
                            </li>
                            <li>
                                <a href="#validateProjects">validateProjects</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(http: <a href="https://angular.io/api/common/http/HttpClient" target="_blank">HttpClient</a>, snackBar: MatSnackBar, BO: <a href="../injectables/BusinessOperationsService.html">BusinessOperationsService</a>, utilitiesService: <a href="../injectables/UtilitiesService.html">UtilitiesService</a>, authService: <a href="../injectables/AuthService.html">AuthService</a>, pageState: <a href="../injectables/PageStateService.html">PageStateService</a>, userService: <a href="../injectables/UserService.html">UserService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="42" class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:42</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>http</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://angular.io/api/common/http/HttpClient" target="_blank" >HttpClient</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>snackBar</td>
                                                  
                                                        <td>
                                                                    <code>MatSnackBar</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>BO</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/BusinessOperationsService.html" target="_self" >BusinessOperationsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>utilitiesService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UtilitiesService.html" target="_self" >UtilitiesService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>authService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/AuthService.html" target="_self" >AuthService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>pageState</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PageStateService.html" target="_self" >PageStateService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserService.html" target="_self" >UserService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addForecasts"></a>
                    <span class="name">
                        <b>
                            addForecasts
                        </b>
                        <a href="#addForecasts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>addForecasts(forecasts: FcEntry[], loadHistory: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="78"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:78</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>adds new forecasts</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>forecasts</td>
                                    <td>
                                            <code>FcEntry[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>loadHistory</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addMandatoryProjects"></a>
                    <span class="name">
                        <b>
                            addMandatoryProjects
                        </b>
                        <a href="#addMandatoryProjects"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>addMandatoryProjects(fcProjects: FcProject[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="284"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:284</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Test if an available project is mandatory and has not been added to the forecast-projects yet
If it has not been added yet: adds it to projects</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>fcProjects</td>
                                    <td>
                                            <code>FcProject[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>FcProject[]</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addProject"></a>
                    <span class="name">
                        <b>
                            addProject
                        </b>
                        <a href="#addProject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>addProject(monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, fcProject: <a href="../classes/FcProject.html">FcProject</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="303"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:303</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Add a project to a forecast entry</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>fcProject</td>
                                    <td>
                                                <code><a href="../classes/FcProject.html" target="_self" >FcProject</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="calculateValues"></a>
                    <span class="name">
                        <b>
                            calculateValues
                        </b>
                        <a href="#calculateValues"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>calculateValues(forecast: <a href="../classes/FcEntry.html">FcEntry</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="337"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:337</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Calculate values: billable days, nonbillable days, projectDays, businessDays, vacationDays, trainingDays, arve, urve</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>forecast</td>
                                    <td>
                                                <code><a href="../classes/FcEntry.html" target="_self" >FcEntry</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/FcEntry.html" target="_self" >FcEntry</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMonthlyForecasts"></a>
                    <span class="name">
                        <b>
                            getMonthlyForecasts
                        </b>
                        <a href="#getMonthlyForecasts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getMonthlyForecasts(monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="473"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:473</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>returns promise of all forecasts for one month
Returns data instantly if they already exist, otherwise: loads them from the server first</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;FcEntry[]&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loadForecast"></a>
                    <span class="name">
                        <b>
                            loadForecast
                        </b>
                        <a href="#loadForecast"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>loadForecast(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="179"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:179</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Load a forecast from the server</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loadForecastHistory"></a>
                    <span class="name">
                        <b>
                            loadForecastHistory
                        </b>
                        <a href="#loadForecastHistory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>loadForecastHistory(forecastId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="198"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:198</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Load the history of a forecast from the server</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>forecastId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;FcEntry[]&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="removeProject"></a>
                    <span class="name">
                        <b>
                            removeProject
                        </b>
                        <a href="#removeProject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>removeProject(monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, index: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="321"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:321</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Remove a project from a forecast entry</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>index</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="reset"></a>
                    <span class="name">
                        <b>
                            reset
                        </b>
                        <a href="#reset"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>reset()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="419"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:419</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Deletes all forecasts from application</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="saveForecast"></a>
                    <span class="name">
                        <b>
                            saveForecast
                        </b>
                        <a href="#saveForecast"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>saveForecast(monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, submit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="218"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:218</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Saves a forecast for a specific month
If submit param is set to true: Forecast gets locked</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>submit</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="setForecast"></a>
                    <span class="name">
                        <b>
                            setForecast
                        </b>
                        <a href="#setForecast"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>setForecast(forecast: <a href="../classes/FcEntry.html">FcEntry</a>, loadHistory: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="90"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:90</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Sets forecast data</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>forecast</td>
                                    <td>
                                                <code><a href="../classes/FcEntry.html" target="_self" >FcEntry</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>loadHistory</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="setForecastComment"></a>
                    <span class="name">
                        <b>
                            setForecastComment
                        </b>
                        <a href="#setForecastComment"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>setForecastComment(monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, comment: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="165"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:165</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Sets the comment of a forecast</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>comment</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="setForecastHistory"></a>
                    <span class="name">
                        <b>
                            setForecastHistory
                        </b>
                        <a href="#setForecastHistory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>setForecastHistory(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, fcHistory: FcEntry[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="148"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:148</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Adds the forecast history to a single forecast</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>fcHistory</td>
                                    <td>
                                            <code>FcEntry[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="unlockForecast"></a>
                    <span class="name">
                        <b>
                            unlockForecast
                        </b>
                        <a href="#unlockForecast"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>unlockForecast(monthId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, locked: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="258"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:258</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Unlocks a forecast: only possible for teamleads</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>monthId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>locked</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="validateProjects"></a>
                    <span class="name">
                        <b>
                            validateProjects
                        </b>
                        <a href="#validateProjects"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>validateProjects(forecast: <a href="../classes/FcEntry.html">FcEntry</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="429"
                            class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:429</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Validates projects before saving forecast</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>forecast</td>
                                    <td>
                                                <code><a href="../classes/FcEntry.html" target="_self" >FcEntry</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/FcEntry.html" target="_self" >FcEntry</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="forecasts"></a>
                        <span class="name">
                            <b>
                            forecasts</b>
                            <a href="#forecasts"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>FcEntry[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="32" class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:32</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>contains all available forecasts which have already been loaded from the server</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="forecasts$"></a>
                        <span class="name">
                            <b>
                            forecasts$</b>
                            <a href="#forecasts$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>BehaviorSubject&lt;FcEntry[]&gt;</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="27" class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:27</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>observable which returns all available forecasts which have already been loaded from the server</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="months"></a>
                        <span class="name">
                            <b>
                            months</b>
                            <a href="#months"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../classes/Month.html" target="_self" >Month[]</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="42" class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:42</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>contains all months</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="projects"></a>
                        <span class="name">
                            <b>
                            projects</b>
                            <a href="#projects"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../classes/Project.html" target="_self" >Project[]</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="37" class="link-to-prism">src/app/core/services/forecasts/forecast.service.ts:37</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>contains all projects</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { HttpClient } from &#x27;@angular/common/http&#x27;;
import { BehaviorSubject } from &#x27;rxjs&#x27;;
import { MatSnackBar } from &#x27;@angular/material&#x27;;

import { FcProject } from &#x27;../../interfaces/fcProject&#x27;;
import { Project } from &#x27;../../interfaces/project&#x27;;
import { FcEntry } from &#x27;../../interfaces/fcEntry&#x27;;
import { BusinessOperationsService } from &#x27;../../shared/business-operations.service&#x27;;
import { Month } from &#x27;../../interfaces/month&#x27;;
import { UtilitiesService } from &#x27;../utilities/utilities.service&#x27;;
import { AuthService } from &#x27;../../security/auth.service&#x27;;
import { PageStateService } from &#x27;../../shared/page-state.service&#x27;;
import { UserService } from &#x27;../users/user.service&#x27;;
import { User } from &#x27;../../interfaces/user&#x27;;

/**
 * forecast service
 */
@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class ForecastService {
  /**
   * observable which returns all available forecasts which have already been loaded from the server
   */
  forecasts$: BehaviorSubject&lt;FcEntry[]&gt;;

  /**
   * contains all available forecasts which have already been loaded from the server
   */
  forecasts: FcEntry[];

  /**
   * contains all projects
   */
  projects: Project[];

  /**
   * contains all months
   */
  months: Month[];

  constructor(
    private http: HttpClient,
    private snackBar: MatSnackBar,
    private BO: BusinessOperationsService,
    private utilitiesService: UtilitiesService,
    private authService: AuthService,
    private pageState: PageStateService,
    private userService: UserService,
  ) {
    this.forecasts &#x3D; [];
    this.forecasts$ &#x3D; new BehaviorSubject([]);

    this.utilitiesService.projects$
      .subscribe((projects: Project[]) &#x3D;&gt; {
        this.projects &#x3D; projects;

        this.forecasts.forEach((forecast: FcEntry) &#x3D;&gt; {
          forecast.projects &#x3D; this.addMandatoryProjects(forecast.projects);
        });
        this.forecasts$.next(this.forecasts);
      });

    this.utilitiesService.months$
      .subscribe((months: Month[]) &#x3D;&gt; {
        this.months &#x3D; months;
      });
  }

  /**
   * adds new forecasts
   * 
   * @param forecasts
   * @param loadHistory
   */
  addForecasts(forecasts: FcEntry[], loadHistory: boolean &#x3D; false): void {
    forecasts.forEach((forecast: FcEntry) &#x3D;&gt; {
      this.setForecast(forecast, loadHistory);
    });
  }

  /**
   * Sets forecast data
   * 
   * @param forecast
   * @param loadHistory
   */
  setForecast(forecast: FcEntry, loadHistory: boolean &#x3D; false): void {
    if (!forecast.userId || !forecast.monthId) {
      return;
    }

    let mandatoryProjects: FcProject[] &#x3D; forecast.projects.filter((p: FcProject) &#x3D;&gt; p.mandatory &#x3D;&#x3D;&#x3D; &#x27;Y&#x27;);
    let nonmandatoryProjects: FcProject[] &#x3D; forecast.projects.filter((p: FcProject) &#x3D;&gt; p.mandatory !&#x3D;&#x3D; &#x27;Y&#x27;);
    if (this.forecasts.find((fc: FcEntry) &#x3D;&gt; fc.userId &#x3D;&#x3D;&#x3D; forecast.userId &amp;&amp; fc.monthId &#x3D;&#x3D;&#x3D; forecast.monthId)) {
      this.forecasts
        .filter((fc: FcEntry) &#x3D;&gt; fc.userId &#x3D;&#x3D;&#x3D; forecast.userId &amp;&amp; fc.monthId &#x3D;&#x3D;&#x3D; forecast.monthId)
        .forEach((fc: FcEntry) &#x3D;&gt; {
          fc.forecastId &#x3D; forecast.forecastId;
          fc.locked &#x3D; forecast.locked;
          fc.comment &#x3D; forecast.comment;
          fc.projects &#x3D; mandatoryProjects;
          //Adds all mandatory projects which are not already set
          if(!fc.locked) {
            fc.projects &#x3D; this.addMandatoryProjects(fc.projects);
          }

          //Adds all non-mandatory projects which have been set
          nonmandatoryProjects.forEach((p: FcProject) &#x3D;&gt; {
              fc.projects.push(p);
            });

          //Calculates summary values
          fc &#x3D; this.calculateValues(fc);

          //Validates entries if there has already been an invalid validation before
          if (fc.instantValidation) {
            fc &#x3D; this.validateProjects(fc);
          }
        });
    } else {

      forecast &#x3D; this.calculateValues(forecast);
      forecast.projects &#x3D; this.addMandatoryProjects(forecast.projects);
      this.forecasts.push(forecast);
    }

    //If history is not set or outdated: reload history
    if (forecast.forecastId &amp;&amp; (!forecast.history || loadHistory)) {
      this.loadForecastHistory(forecast.forecastId)
      .then((fcHistory: FcEntry[]) &#x3D;&gt; {
        this.setForecastHistory(forecast.userId, forecast.monthId, fcHistory ? fcHistory : []);
      }).catch(() &#x3D;&gt; {});
    }

    this.forecasts$.next(this.forecasts);
  }

  /**
   * Adds the forecast history to a single forecast
   * 
   * @param userId
   * @param monthId
   * @param fcHistory
   */
  setForecastHistory(userId: number, monthId: number, fcHistory: FcEntry[]): void {
    this.forecasts
      .filter((fc: FcEntry) &#x3D;&gt; fc.userId &#x3D;&#x3D;&#x3D; userId &amp;&amp; fc.monthId &#x3D;&#x3D;&#x3D; monthId)
      .forEach((fcEntry: FcEntry) &#x3D;&gt; {
        fcEntry.history &#x3D; fcHistory;
      });

    this.forecasts$.next(this.forecasts);
  }

  /**
   * Sets the comment of a forecast
   * 
   * @param monthId
   * @param userId
   * @param comment
   */
  setForecastComment(monthId: number, userId: number, comment: string): void {
    this.forecasts
      .filter((fc: FcEntry) &#x3D;&gt; fc.userId &#x3D;&#x3D;&#x3D; userId &amp;&amp; fc.monthId &#x3D;&#x3D;&#x3D; monthId)
      .forEach((fc: FcEntry) &#x3D;&gt; {
        fc.comment &#x3D; comment;
      });
  }

  /**
   * Load a forecast from the server
   * 
   * @param userId
   * @param monthId
   */
  loadForecast(userId: number, monthId: number): void {
    this.http.get&lt;FcEntry&gt;(this.BO.forecast(userId, monthId)).subscribe(
      (fcEntry: FcEntry) &#x3D;&gt; {
        if (fcEntry) {
          this.addForecasts([fcEntry], true);
        } else {
          let forecast: FcEntry &#x3D; new FcEntry();
          forecast.monthId &#x3D; monthId;
          forecast.userId &#x3D; userId;
          this.addForecasts([forecast]);
        }
      });
  }

  /**
   * Load the history of a forecast from the server
   * 
   * @param forecastId
   */
  loadForecastHistory(forecastId: number): Promise&lt;FcEntry[]&gt; {
    return new Promise((resolve: any, reject: any) &#x3D;&gt; {

      this.http.get&lt;FcEntry[]&gt;(this.BO.forecastHistory(forecastId)).subscribe(
        (fcEntries: FcEntry[]) &#x3D;&gt; {
          resolve(fcEntries);
        }, (e: any) &#x3D;&gt; {
          reject([]);
        });
    });
  }

  /**
   * Saves a forecast for a specific month
   * If submit param is set to true: Forecast gets locked
   * 
   * @param monthId
   * @param userId
   * @param submit
   */
  saveForecast(monthId: number, userId: number, submit: boolean &#x3D; false): void {
    let forecast: FcEntry &#x3D; this.forecasts.find((fc: FcEntry) &#x3D;&gt; fc.userId &#x3D;&#x3D;&#x3D; userId &amp;&amp; fc.monthId &#x3D;&#x3D;&#x3D; monthId);
    if (!forecast) {
      return;
    }

    forecast &#x3D; this.validateProjects(forecast);
    if (([].concat.apply([], forecast.projects.map((p: FcProject) &#x3D;&gt; p.errors))).length &gt; 0) {
      forecast.instantValidation &#x3D; true;
      this.setForecast(forecast);

      this.snackBar.open(&#x27;Forecast cannot be saved due to one or more invalid data fields.&#x27;, &#x27;OK&#x27;, { duration: 5000, });
      return;
    }

    if (submit) {
      forecast.locked &#x3D; true;
    } else {
      forecast.locked &#x3D; false;
    }

    forecast.history &#x3D; undefined;

    this.pageState.showSpinner();
    this.http.put(this.BO.forecast(userId, monthId), forecast)
      .subscribe((fc: FcEntry) &#x3D;&gt; {
        this.setForecast(fc, true);
        this.snackBar.open(&#x27;Forecast-Entry successfully saved!&#x27;, &#x27;OK&#x27;, { duration: 5000, });
        this.pageState.hideSpinner();

      }, (e: any) &#x3D;&gt; {
        this.snackBar.open(&#x27;Forecast-Entry could not be saved!&#x27;, &#x27;OK&#x27;, { duration: 10000, });
        this.pageState.hideSpinner();

      });
  }

  /**
   * Unlocks a forecast: only possible for teamleads
   */
  unlockForecast(monthId: number, userId: number, locked: boolean): void {
    this.http.put(this.BO.unlockForecast(userId, monthId), {})
      .subscribe((forecast: FcEntry) &#x3D;&gt; {

        this.forecasts
          .filter((fc: FcEntry) &#x3D;&gt; fc.userId &#x3D;&#x3D;&#x3D; userId &amp;&amp; fc.monthId &#x3D;&#x3D;&#x3D; monthId)
          .forEach((fc: FcEntry) &#x3D;&gt; {
            fc.locked &#x3D; locked;
          });
        this.forecasts$.next(this.forecasts);

        this.pageState.hideSpinner();

      }, (e: any) &#x3D;&gt; {
        this.snackBar.open(&#x27;Forecast-Entry could not be unlocked!&#x27;, &#x27;OK&#x27;, { duration: 10000, });
        this.pageState.hideSpinner();

      });
  }

  /**
   * Test if an available project is mandatory and has not been added to the forecast-projects yet
   * If it has not been added yet: adds it to projects
   * 
   * @param fcProjects
   */
  addMandatoryProjects(fcProjects: FcProject[]): FcProject[] {
    let mandatory: number[] &#x3D; this.projects.filter((p: Project) &#x3D;&gt; p.active &#x3D;&#x3D;&#x3D; true &amp;&amp; p.mandatory &#x3D;&#x3D;&#x3D; &#x27;Y&#x27;).map((p: Project) &#x3D;&gt; p.id);

    mandatory.forEach((mp: number) &#x3D;&gt; {
      if (!fcProjects.find((p: FcProject) &#x3D;&gt; p.projectId &#x3D;&#x3D;&#x3D; mp)) {
        fcProjects.push({ projectId: mp, plannedProjectDays: 0, probabilityId: 2, cor: 0, externalRevenue: false, mandatory: &#x27;Y&#x27; });
      }
    });

    return fcProjects;
  }

  /**
   * Add a project to a forecast entry
   * 
   * @param monthId
   * @param userId
   * @param fcProject
   */
  addProject(monthId: number, userId: number, fcProject: FcProject): void {
    this.forecasts
      .filter((fc: FcEntry) &#x3D;&gt; fc.monthId &#x3D;&#x3D;&#x3D; monthId &amp;&amp; fc.userId &#x3D;&#x3D;&#x3D; userId)
      .forEach((fc: FcEntry) &#x3D;&gt; {
        fc.projects &#x3D; fc.projects.filter((p: FcProject) &#x3D;&gt; p.projectId !&#x3D;&#x3D; fcProject.projectId);
        fc.projects.push(fcProject);
      });

    this.forecasts$.next(this.forecasts);
  }

  /**
   * Remove a project from a forecast entry
   * 
   * @param monthId
   * @param userId
   * @param index
   */
  removeProject(monthId: number, userId: number, index: number): void {
    this.forecasts
      .filter((fc: FcEntry) &#x3D;&gt; fc.monthId &#x3D;&#x3D;&#x3D; monthId &amp;&amp; fc.userId &#x3D;&#x3D;&#x3D; userId)
      .forEach((fc: FcEntry) &#x3D;&gt; {
        fc.projects.splice(index, 1);
        fc &#x3D; this.calculateValues(fc);
      });

    this.forecasts$.next(this.forecasts);
  }

  /**
   * Calculate values: billable days, nonbillable days, projectDays, businessDays, vacationDays, trainingDays, arve, urve
   * 
   * @param forecast
   */
  calculateValues(forecast: FcEntry): FcEntry {
    forecast.totalDays &#x3D; this.months.find((m: Month) &#x3D;&gt; m.id &#x3D;&#x3D;&#x3D; forecast.monthId) ? parseInt(this.months.find((m: Month) &#x3D;&gt; m.id &#x3D;&#x3D;&#x3D; forecast.monthId).workingdays) : 0;
    let u: User &#x3D; this.userService.getUser(forecast.userId);
    if (u &amp;&amp; u.fte) {
      forecast.totalDays *&#x3D; u.fte;
    }

    //calculate billable + non-billable days
    forecast.billableDays &#x3D; 0;
    forecast.nonbillableDays &#x3D; 0;
    forecast.projects.forEach((p: FcProject) &#x3D;&gt; {
      if (p.billable) {
        forecast.billableDays +&#x3D; (p.plannedProjectDays ? p.plannedProjectDays : 0 );
      } else {
        forecast.nonbillableDays +&#x3D; (p.plannedProjectDays ? p.plannedProjectDays : 0 );
      }
    });

    //Calculate total project days (without vacation, training + business-development days)
    forecast.projectDays &#x3D; 0;
    forecast.projects
      .filter((p: FcProject) &#x3D;&gt;
        this.projects.find((ap: Project) &#x3D;&gt; ap.projectType &#x3D;&#x3D;&#x3D; 0 &amp;&amp; ap.id &#x3D;&#x3D;&#x3D; p.projectId)
      )
      .forEach((p: FcProject) &#x3D;&gt;
        forecast.projectDays +&#x3D; (p.plannedProjectDays ? p.plannedProjectDays : 0)
      );

    forecast.businessDays &#x3D; 0;
    forecast.vacationDays &#x3D; 0;
    forecast.trainingDays &#x3D; 0;
    if (this.projects.length &gt; 0 &amp;&amp; forecast.projects.length &gt; 0) {
      
      //Calculate vacation days
      let vacationProject: Project &#x3D; this.projects.find((ap: Project) &#x3D;&gt; ap.projectType &#x3D;&#x3D;&#x3D; 3);
      if (vacationProject) {
        let project: FcProject &#x3D; forecast.projects.find((p: FcProject) &#x3D;&gt; p.projectId &#x3D;&#x3D;&#x3D; vacationProject.id);
        if (project &amp;&amp; project.plannedProjectDays) {
          forecast.vacationDays &#x3D; project.plannedProjectDays;
        }
      }

      //Calculate training days
      let trainingProject: Project &#x3D; this.projects.find((ap: Project) &#x3D;&gt; ap.projectType &#x3D;&#x3D;&#x3D; 2);
      if (trainingProject) {
        let project: FcProject &#x3D; forecast.projects.find((p: FcProject) &#x3D;&gt; p.projectId &#x3D;&#x3D;&#x3D; trainingProject.id);
        if (project &amp;&amp; project.plannedProjectDays) {
          forecast.trainingDays &#x3D; project.plannedProjectDays;
        }
      }

      //Calculate business development days
      let businessProject: Project &#x3D; this.projects.find((ap: Project) &#x3D;&gt; ap.projectType &#x3D;&#x3D;&#x3D; 1);
      if (businessProject) {
        let project: FcProject &#x3D; forecast.projects.find((p: FcProject) &#x3D;&gt; p.projectId &#x3D;&#x3D;&#x3D; businessProject.id);
        if (project &amp;&amp; project.plannedProjectDays) {
          forecast.businessDays &#x3D; project.plannedProjectDays;
        }
      }
    }

    //Calculate URVE + ARVE
    forecast.urve &#x3D; (forecast.billableDays !&#x3D;&#x3D; 0) ? ((forecast.projectDays + forecast.businessDays) / (forecast.totalDays - forecast.vacationDays)) : 0;
    if (forecast.urve &gt; 1) {
      forecast.urve &#x3D; 1;
    } else if (forecast.urve &lt; 0) {
      forecast.urve &#x3D; 0;
    }
    
    forecast.arve &#x3D; (forecast.billableDays !&#x3D;&#x3D; 0) ? (forecast.billableDays / forecast.totalDays) : 0;
    if (forecast.arve &gt; 1) {
      forecast.arve &#x3D; 1;
    } else if (forecast.arve &lt; 0) {
      forecast.arve &#x3D; 0;
    }

    return forecast;
  }

  /**
   * Deletes all forecasts from application
   */
  reset(): void {
    this.forecasts &#x3D; [];
    this.forecasts$.next(this.forecasts);
  }

  /**
   * Validates projects before saving forecast
   * 
   * @param forecast
   */
  validateProjects(forecast: FcEntry): FcEntry {
    forecast.projects.forEach((p: FcProject) &#x3D;&gt; {
      p.errors &#x3D; [];

      if (typeof p.projectId &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
        p.errors.push(&#x27;No project selected.&#x27;);
      } else if (!this.projects.find((project: Project) &#x3D;&gt; project.id &#x3D;&#x3D; p.projectId)) {
        p.errors.push(&#x27;Project not found.&#x27;);
      }

      if (typeof p.cor &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
        if (this.authService.getRole() &#x3D;&#x3D;&#x3D; &#x27;user&#x27;) {
          p.cor &#x3D; 0;
        } else {
          p.errors.push(&#x27;No COR value defined.&#x27;);
        }
      } else if (typeof p.cor !&#x3D;&#x3D; &#x27;number&#x27;) {
        p.errors.push(&#x27;COR value has to be a number.&#x27;);
      } else if (p.cor &lt; 0) {
        p.errors.push(&#x27;COR value has to be a positive number.&#x27;);
      }

      if (typeof p.plannedProjectDays &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
        p.errors.push(&#x27;Number of project days not specified.&#x27;);
      } else if (typeof p.plannedProjectDays !&#x3D;&#x3D; &#x27;number&#x27;) {
        p.errors.push(&#x27;Project days value has to be a number.&#x27;);
      } else if (p.plannedProjectDays &lt; 0) {
        p.errors.push(&#x27;Project days value has to be a positive number.&#x27;);
      }

      if (!p.probabilityId) {
        p.errors.push(&#x27;No probability defined.&#x27;);
      }
    });

    return forecast;
  }

  /**
   * returns promise of all forecasts for one month
   * Returns data instantly if they already exist, otherwise: loads them from the server first
   * 
   * @param monthId
   */
  getMonthlyForecasts(monthId: number): Promise&lt;FcEntry[]&gt; {
    let promise: Promise&lt;FcEntry[]&gt; &#x3D; new Promise((resolve, reject) &#x3D;&gt; {
      let fcEntries: FcEntry[] &#x3D; this.forecasts$.getValue().filter((fc: FcEntry) &#x3D;&gt; fc.monthId &#x3D;&#x3D;&#x3D; monthId);
      if (fcEntries.length &gt; 0) {
        resolve(fcEntries);
      } else {
        this.http.get&lt;FcEntry[]&gt;(this.BO.teamForecast(this.authService.getUserId(), monthId)).subscribe((fc: FcEntry[]) &#x3D;&gt; {
          resolve(fc);
        });
      }
    });

    return promise;
  }
}
</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ForecastService.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
